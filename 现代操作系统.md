## 第8章 多处理机系统

**问题**

1、为什么要使用多处理机系统？

多种多样的应用需要更强的计算能力，而相对论对时钟速度的限制导致了单处理机的计算能力存在瓶颈，需要采用多处理机系统。

2、多处理机系统有几种类型？它们的不同点？

共享存储器多处理机系统：多个CPU共享一个存储器并通过它通信。

多计算机系统：每个CPU对应一个存储器，并通过互联网络发送消息通信。

分布式系统：完整的计算机通过一个广域网连接起来。

三种系统在架构上是不同的，并且在通信延迟上有三个数量级的区别。

**要点**

1、在电子部件之间的所有通信，归根结底是在它们之间发送消息——具有良好定义的位串。

### 8.1 多处理机

**要点**

1、共享存储器多处理机，采用多个CPU共享访问一个公用的RAM，任何一个CPU上的程序看到一个普通的虚拟地址空间。

#### 8.1.1 多处理机硬件

**问题**

1、UMA、NUMA、多核芯片、片上系统、众核芯片的含义？

UMA： 统一存储器访问多处理机，CPU读取每个存储器字的速度一样快

NUMA：非一致存储器访问多处理机。

多核芯片：将多个完整的CPU放到同一个芯片上，每个核既有自己单独的高速缓存，也可能有共享的高速缓存，并且必然共享内存。

片上系统：含有一个或多个主CPU，但同时包含若干个专用核，如视频与音频解码器、加密芯片、网络接口等。

众核芯片：含有非常多的核，并不在乎损失一两个核心，GPU为众核芯片。

#### 8.1.2 多处理器操作系统类型

**问题**

1、多处理器操作系统存在哪些类型？

每个CPU有自己的操作系统：为每个CPU提供私有存储器以及操作系统的各自私有副本，CPU以独立计算机形式运行。

主从多处理机：操作系统副本核数据表都在一个CPU上，其他CPU都是从属CPU。主CPU执行系统调用和用户进程，从CPU只执行用户进程。

对称多处理机：每个CPU都可以运行在存储器中的操作系统副本，并通过互斥信号量实现同步。

#### 8.1.3 多处理机同步

**要点**

多处理机系统可以使用互斥信号量、信号量、管程和其他适合的技术实现同步。

#### 8.1.4 多处理机调度

### 8.2 多计算机

**要点**

大型多处理机构造困难，造价高昂，所以出现了多计算机。

#### 8.2.1 多计算机硬件

**要点**

多计算机系统基本节点包括一个CPU、存储器、一个网络接口，通常没有图像适配卡、显示器、键盘和鼠标。

多计算机系统有很多不同的互联拓扑结构。

#### 8.2.2 低层通信软件

在多计算机系统中高性能通信的敌人是对包的过度复制。

#### 8.2.3 用户层通信软件

操作系统提供了发送和接收消息的途径，用户可以调用操作系统的接口发送和接收消息。

#### 8.2.4 远程过程调用

远程过程调用（RPC）：机器1的进程调用机器2的进程时，在机器1中的调用进程被挂起，在机器2中被调用的过程执行。可以在参数中传递从调用者到被调用者的信息，并且可在过程的处理结果中返回信息。

远程过程调用区别于I/O模型的通信。

RPC背后的思想是尽可能使远程过程调用像本地调用，客户程序必须被绑定在一个称为客户端存根的小型库过程上，在客户机地址空间中代表服务器程序。服务器程序也绑定在一个称为服务器端存根的过程上。

#### 8.2.5 分布式共享存储器

分布式共享存储器（DSM），该技术可以很好地保留共享存储器的幻觉。

#### 8.2.6 多计算机调度

#### 8.2.7  负载均衡

### 8.3 分布式系统

